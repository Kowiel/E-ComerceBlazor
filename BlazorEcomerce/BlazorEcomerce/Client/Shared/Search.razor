@using BlazorEcomerce.Shared.Services
@inject NavigationManager _navmenager;
@inject IProductService _ProductService;
@inject ICategoryService _CategoryService;

<div class="input-group-text">
    <HomeButon/>
    <input @bind-value = "SearchText"
           @bind-value:event="oninput"
           type="search"
           list="products"
           @onkeyup="HandleSearh"
           class="form-control"
           placeholder="Search..."
           @ref="SearchImput"/>
    <datalist id="products">
        @foreach (var item in Sugestions)
       {
           <option>@item</option>
       }
    </datalist>
    <input list="Categories" id="Categories-list" name="Categories-Selection" class="ComboBox">
<datalist id="Categories">
    <option>All</option>
     @foreach (var Categorie in  _CategoryService.Categories)
       {
           <option>@Categorie.Name</option>
       }
</datalist>
    <div class="input-group-append">
        <button class="btn btn-primary" @onclick="SearchProducts">
            <span class="oi oi-magnifying-glass"></span>
        </button>
    </div>
</div>

@code 
{
    private string SearchText = string.Empty;
    private int ProductsPerPage = 3;
    private List<string> Sugestions = new List<string>();
    protected ElementReference SearchImput;

    protected override async void OnAfterRender(bool firstRender)
    {
        if(firstRender)
        {
            await SearchImput.FocusAsync();
        }
    }
    public void SearchProducts()
    {
        if (SearchText.Length < 2)
            _navmenager.NavigateTo("/");
        else
        _navmenager.NavigateTo($"search/{SearchText}/{ProductsPerPage}/1");
    }

    public async Task HandleSearh(KeyboardEventArgs arg)
        {
            if(arg.Key==null || arg.Key.Equals("Enter"))
            {
                SearchProducts();
            }
            else if(SearchText.Length>2)
            {
                Sugestions = await _ProductService.GetProductSercheSugestion(SearchText);
            }
        }
}
